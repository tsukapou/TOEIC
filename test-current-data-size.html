<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºç¢ºèª</title>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 2rem;
        }
        .subtitle {
            color: #6b7280;
            margin-bottom: 32px;
            font-size: 1rem;
        }
        .section {
            margin-bottom: 32px;
            padding: 24px;
            background: #f9fafb;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }
        .section h2 {
            color: #374151;
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 1.3rem;
        }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
        }
        .stat-card .label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .stat-card .value {
            color: #1f2937;
            font-size: 1.8rem;
            font-weight: 700;
        }
        .stat-card .value.success {
            color: #10b981;
        }
        .stat-card .value.warning {
            color: #f59e0b;
        }
        .stat-card .value.error {
            color: #ef4444;
        }
        .stat-card .sub {
            color: #9ca3af;
            font-size: 0.8rem;
            margin-top: 4px;
        }
        .result-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #e5e7eb;
        }
        .result-box h3 {
            margin-top: 0;
            color: #374151;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid #10b981;
        }
        .warning-message {
            background: #fef3c7;
            color: #92400e;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid #f59e0b;
        }
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid #ef4444;
        }
        .solution {
            background: #e0e7ff;
            color: #3730a3;
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid #6366f1;
        }
        .solution h4 {
            margin-top: 0;
            color: #3730a3;
        }
        .solution ul {
            margin: 8px 0;
            padding-left: 24px;
        }
        .solution li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºç¢ºèª</h1>
        <p class="subtitle">QRã‚³ãƒ¼ãƒ‰ã«åã¾ã‚‰ãªã„åŸå› ã‚’èª¿æŸ»ã—ã¾ã™</p>
        
        <div class="section">
            <h2>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºåˆ†æ</h2>
            <button onclick="analyzeCurrentData()">ğŸ” ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã‚’ç¢ºèª</button>
            <div id="analysisResult"></div>
        </div>
    </div>
    
    <script>
        // LocalStorageã‚­ãƒ¼å®šç¾©
        const STORAGE_KEYS = {
            progress: 'toeic_part5_progress',
            scores: 'toeic_part5_scores',
            selectedSecretary: 'toeic_selected_secretary',
            unlockedSecretaries: 'toeic_unlocked_secretaries',
            wrongAnswers: 'toeic_wrong_answers',
            reviewProgress: 'toeic_review_progress',
            streakData: 'toeic_streak_data',
            dailyMissions: 'toeic_daily_missions',
            pointRewards: 'toeic_point_rewards',
            weaknessAnalysis: 'toeic_weakness_analysis',
            patternProgress: 'toeic_pattern_progress',
            secretaryDaily: 'toeic_secretary_daily_last',
            achievements: 'toeic_reward_achievements',
            userProfile: 'toeic_user_profile'
        };
        
        function analyzeCurrentData() {
            try {
                console.log('ğŸ” ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºåˆ†æé–‹å§‹...');
                
                // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                const exportData = {
                    version: '1.0.0',
                    exportDate: new Date().toISOString(),
                    exportTimestamp: Date.now(),
                    data: {}
                };
                
                let totalOriginalSize = 0;
                const breakdown = [];
                
                // å„ã‚­ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
                Object.entries(STORAGE_KEYS).forEach(([key, storageKey]) => {
                    const value = localStorage.getItem(storageKey);
                    if (value) {
                        try {
                            exportData.data[storageKey] = JSON.parse(value);
                        } catch (e) {
                            exportData.data[storageKey] = value;
                        }
                        
                        const size = new Blob([value]).size;
                        totalOriginalSize += size;
                        breakdown.push({
                            name: key,
                            storageKey: storageKey,
                            size: size,
                            sizeKB: (size / 1024).toFixed(2),
                            percentage: 0 // å¾Œã§è¨ˆç®—
                        });
                    }
                });
                
                // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¨ˆç®—
                breakdown.forEach(item => {
                    item.percentage = ((item.size / totalOriginalSize) * 100).toFixed(1);
                });
                
                // ã‚½ãƒ¼ãƒˆï¼ˆã‚µã‚¤ã‚ºé™é †ï¼‰
                breakdown.sort((a, b) => b.size - a.size);
                
                // JSONæ–‡å­—åˆ—åŒ–
                const jsonString = JSON.stringify(exportData);
                const jsonSize = new Blob([jsonString]).size;
                
                // LZ-Stringåœ§ç¸®
                const compressed = LZString.compressToBase64(jsonString);
                const compressedSize = new Blob([compressed]).size;
                const compressionRate = ((1 - compressedSize / jsonSize) * 100).toFixed(1);
                
                // QRã‚³ãƒ¼ãƒ‰å®¹é‡
                const QR_MAX_SIZE = 2953;
                const isOverCapacity = compressedSize > QR_MAX_SIZE;
                const overAmount = compressedSize - QR_MAX_SIZE;
                
                console.log(`ğŸ“Š åˆ†æçµæœ:`);
                console.log(`  å…ƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${(jsonSize / 1024).toFixed(2)} KB`);
                console.log(`  åœ§ç¸®å¾Œã‚µã‚¤ã‚º: ${(compressedSize / 1024).toFixed(2)} KB`);
                console.log(`  åœ§ç¸®ç‡: ${compressionRate}%`);
                console.log(`  QRå®¹é‡åˆ¶é™: ${(QR_MAX_SIZE / 1024).toFixed(2)} KB`);
                console.log(`  å®¹é‡ã‚ªãƒ¼ãƒãƒ¼: ${isOverCapacity ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                
                // çµæœè¡¨ç¤º
                let resultHTML = '<div class="stats">';
                resultHTML += `
                    <div class="stat-card">
                        <div class="label">å…ƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º</div>
                        <div class="value">${(jsonSize / 1024).toFixed(2)}</div>
                        <div class="sub">KB</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">åœ§ç¸®å¾Œã‚µã‚¤ã‚º</div>
                        <div class="value ${isOverCapacity ? 'error' : 'success'}">${(compressedSize / 1024).toFixed(2)}</div>
                        <div class="sub">KB</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">åœ§ç¸®ç‡</div>
                        <div class="value success">${compressionRate}%</div>
                        <div class="sub">å‰Šæ¸›</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">QRå®¹é‡åˆ¶é™</div>
                        <div class="value">${(QR_MAX_SIZE / 1024).toFixed(2)}</div>
                        <div class="sub">KB</div>
                    </div>
                `;
                resultHTML += '</div>';
                
                // å®¹é‡ã‚ªãƒ¼ãƒãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (isOverCapacity) {
                    resultHTML += `
                        <div class="error-message">
                            <strong>âš ï¸ å®¹é‡ã‚ªãƒ¼ãƒãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™</strong><br>
                            ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${(compressedSize / 1024).toFixed(2)} KB<br>
                            QRã‚³ãƒ¼ãƒ‰åˆ¶é™: ${(QR_MAX_SIZE / 1024).toFixed(2)} KB<br>
                            è¶…éé‡: ${(overAmount / 1024).toFixed(2)} KBï¼ˆ${((overAmount / QR_MAX_SIZE) * 100).toFixed(1)}%è¶…éï¼‰
                        </div>
                    `;
                    
                    // è§£æ±ºç­–ã‚’è¡¨ç¤º
                    resultHTML += `
                        <div class="solution">
                            <h4>ğŸ’¡ è§£æ±ºç­–ï¼ˆ3ã¤ã®é¸æŠè‚¢ï¼‰</h4>
                            <ul>
                                <li><strong>âœ… æ¨å¥¨ï¼šã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼</strong>
                                    <br>â†’ ã€ŒğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ï¼ˆå®¹é‡ç„¡åˆ¶é™ï¼‰
                                    <br>â†’ LINEã‚„ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã—ã¦åˆ¥ç«¯æœ«ã«ãƒšãƒ¼ã‚¹ãƒˆ
                                </li>
                                <li><strong>âœ… æ¨å¥¨ï¼šJSONãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</strong>
                                    <br>â†’ ã€Œãã®ä»–ã®å¼•ç¶™ãæ–¹æ³•ã€â†’ã€ŒğŸ’¾ ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€
                                    <br>â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒ¼ãƒ«/ã‚¯ãƒ©ã‚¦ãƒ‰ã§é€ä¿¡
                                </li>
                                <li><strong>ğŸ”œ ä»Šå¾Œå®Ÿè£…äºˆå®šï¼šåˆ†å‰²QRã‚³ãƒ¼ãƒ‰</strong>
                                    <br>â†’ ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®QRã‚³ãƒ¼ãƒ‰ã«åˆ†å‰²
                                    <br>â†’ ç¾åœ¨ã¯é–‹ç™ºä¸­
                                </li>
                            </ul>
                        </div>
                    `;
                } else {
                    resultHTML += `
                        <div class="success-message">
                            <strong>âœ… QRã‚³ãƒ¼ãƒ‰ã«åã¾ã‚Šã¾ã™ï¼</strong><br>
                            ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${(compressedSize / 1024).toFixed(2)} KB<br>
                            QRã‚³ãƒ¼ãƒ‰åˆ¶é™: ${(QR_MAX_SIZE / 1024).toFixed(2)} KB<br>
                            ä½™è£•: ${((QR_MAX_SIZE - compressedSize) / 1024).toFixed(2)} KB
                        </div>
                    `;
                }
                
                // ãƒ‡ãƒ¼ã‚¿å†…è¨³è¡¨ç¤º
                resultHTML += '<div class="result-box">';
                resultHTML += '<h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿å†…è¨³ï¼ˆã‚µã‚¤ã‚ºé™é †ï¼‰</h3>';
                resultHTML += '<table>';
                resultHTML += '<thead><tr><th>é …ç›®</th><th>ã‚µã‚¤ã‚º (KB)</th><th>å‰²åˆ</th></tr></thead>';
                resultHTML += '<tbody>';
                
                breakdown.forEach(item => {
                    resultHTML += `
                        <tr>
                            <td><strong>${item.name}</strong><br><small style="color: #6b7280;">${item.storageKey}</small></td>
                            <td>${item.sizeKB} KB</td>
                            <td>${item.percentage}%</td>
                        </tr>
                    `;
                });
                
                resultHTML += '</tbody></table>';
                resultHTML += '</div>';
                
                // å¤§ããªãƒ‡ãƒ¼ã‚¿ã®å‰Šæ¸›ææ¡ˆ
                if (isOverCapacity) {
                    const largeItems = breakdown.filter(item => parseFloat(item.percentage) > 20);
                    if (largeItems.length > 0) {
                        resultHTML += `
                            <div class="warning-message">
                                <h4>ğŸ“ ãƒ‡ãƒ¼ã‚¿å‰Šæ¸›ã®ææ¡ˆ</h4>
                                <p>ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¨ä½“ã®20%ä»¥ä¸Šã‚’å ã‚ã¦ã„ã¾ã™ï¼š</p>
                                <ul>
                        `;
                        largeItems.forEach(item => {
                            resultHTML += `<li><strong>${item.name}</strong>: ${item.sizeKB} KB (${item.percentage}%)</li>`;
                        });
                        resultHTML += `
                                </ul>
                                <p><strong>æ³¨æ„</strong>: ãƒ‡ãƒ¼ã‚¿ã¯å­¦ç¿’é€²æ—ã«é‡è¦ã§ã™ã€‚å‰Šé™¤ã›ãšã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
                            </div>
                        `;
                    }
                }
                
                document.getElementById('analysisResult').innerHTML = resultHTML;
                
                console.log('âœ… ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºåˆ†æå®Œäº†');
                console.table(breakdown);
                
            } catch (error) {
                console.error('âŒ ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºåˆ†æã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('analysisResult').innerHTML = 
                    `<div class="error-message">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            analyzeCurrentData();
        });
    </script>
</body>
</html>
