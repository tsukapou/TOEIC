<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éû„Ç§„Çπ„Ç≥„Ç¢„Éö„Éº„Ç∏ „ÉÜ„Çπ„Éà</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #f3f4f6;
        }
        .test-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #5568d3;
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üìä „Éû„Ç§„Çπ„Ç≥„Ç¢„Éö„Éº„Ç∏ Âãï‰Ωú„ÉÜ„Çπ„Éà</h1>
    
    <div class="test-panel">
        <h2>üß™ „ÉÜ„Çπ„Éà„Ç∑„Éä„É™„Ç™</h2>
        <button onclick="scenario1()">1Ô∏è‚É£ „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå0‰ª∂„ÅÆÂ†¥Âêà</button>
        <button onclick="scenario2()">2Ô∏è‚É£ „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå1‰ª∂„ÅÆÂ†¥Âêà</button>
        <button onclick="scenario3()">3Ô∏è‚É£ „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå5‰ª∂„ÅÆÂ†¥Âêà</button>
        <button onclick="scenario4()">4Ô∏è‚É£ „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå10‰ª∂‰ª•‰∏ä„ÅÆÂ†¥Âêà</button>
        <button onclick="clearData()">üóëÔ∏è „Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢</button>
    </div>
    
    <div class="test-panel">
        <h2>üìã ÂÆüË°å„É≠„Ç∞</h2>
        <div id="log" class="log">„ÉÜ„Çπ„Éà„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ...</div>
    </div>
    
    <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫„Ç®„É™„Ç¢ -->
    <div id="scoreDisplay" style="display: none;">
        <div class="test-panel">
            <h2>üè† „Éõ„Éº„É†ÁîªÈù¢„ÅÆ„Çπ„Ç≥„Ç¢‰∫àÊ∏¨</h2>
            <div id="latestScorePrediction" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 15px; color: white;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">PART5‰∫àÊ∏¨</p>
                        <p id="homePart5Score" style="font-size: 32px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 200ÁÇπ</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 15px; color: white;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">„É™„Éº„Éá„Ç£„É≥„Ç∞</p>
                        <p id="homeReadingScore" style="font-size: 32px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 495ÁÇπ</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 15px; color: white;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">Á∑èÂêà‰∫àÊ∏¨</p>
                        <p id="homeTotalScore" style="font-size: 24px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 990ÁÇπ</p>
                    </div>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 8px;">
                    <div>
                        <span style="font-size: 14px; color: #6b7280;">„É¨„Éô„É´: </span>
                        <span id="homeScoreLevel" style="font-size: 14px; font-weight: 600;">---</span>
                    </div>
                    <div id="homeScoreDate" style="font-size: 12px; color: #9ca3af;">---</div>
                </div>
            </div>
        </div>
        
        <div class="test-panel">
            <h2>üìä „Éû„Ç§„Çπ„Ç≥„Ç¢ÁîªÈù¢</h2>
            <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">ÊúÄÊñ∞„ÅÆ„Çπ„Ç≥„Ç¢‰∫àÊ∏¨</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 15px; color: white; text-align: center;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">PART5‰∫àÊ∏¨</p>
                        <p id="myScorePart5" style="font-size: 40px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 200ÁÇπ</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 15px; color: white; text-align: center;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">„É™„Éº„Éá„Ç£„É≥„Ç∞</p>
                        <p id="myScoreReading" style="font-size: 40px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 495ÁÇπ</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 15px; color: white; text-align: center;">
                        <p style="font-size: 12px; opacity: 0.9; margin: 0 0 5px 0;">Á∑èÂêà‰∫àÊ∏¨</p>
                        <p id="myScoreTotal" style="font-size: 32px; font-weight: 700; margin: 0;">---</p>
                        <p style="font-size: 12px; opacity: 0.8; margin: 5px 0 0 0;">/ 990ÁÇπ</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                    <div style="background: #f9fafb; border-radius: 8px; padding: 12px; text-align: center;">
                        <p style="font-size: 12px; color: #6b7280; margin: 0 0 5px 0;">Ê≠£Á≠îÁéá</p>
                        <p id="myScoreAccuracy" style="font-size: 24px; font-weight: 700; margin: 0;">---%</p>
                    </div>
                    <div style="background: #f9fafb; border-radius: 8px; padding: 12px; text-align: center;">
                        <p style="font-size: 12px; color: #6b7280; margin: 0 0 5px 0;">„É¨„Éô„É´</p>
                        <p id="myScoreLevel" style="font-size: 16px; font-weight: 700; margin: 0;">---</p>
                    </div>
                    <div style="background: #f9fafb; border-radius: 8px; padding: 12px; text-align: center;">
                        <p style="font-size: 12px; color: #6b7280; margin: 0 0 5px 0;">ÂâçÂõû„ÉÜ„Çπ„Éà</p>
                        <p id="myScoreDate" style="font-size: 14px; font-weight: 600; margin: 0;">---</p>
                    </div>
                </div>
            </div>
            
            <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 15px;">üìà „Çπ„Ç≥„Ç¢Â±•Ê≠¥„Ç∞„É©„Éï</h3>
                <canvas id="scoreHistoryChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'toeic_part5_scores';
        let logElement;
        
        function log(message, type = 'info') {
            if (!logElement) logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logElement.textContent += `[${timestamp}] ${icon} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearData() {
            localStorage.removeItem(STORAGE_KEY);
            log('LocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'success');
            document.getElementById('scoreDisplay').style.display = 'none';
        }
        
        function loadTestHistory() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }
        
        function saveTestHistory(history) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }
        
        function predictTOEICScore(correctCount, totalQuestions) {
            const accuracy = correctCount / totalQuestions;
            
            let predictedPart5Score;
            if (accuracy >= 0.95) predictedPart5Score = 180;
            else if (accuracy >= 0.90) predictedPart5Score = 170;
            else if (accuracy >= 0.85) predictedPart5Score = 160;
            else if (accuracy >= 0.80) predictedPart5Score = 150;
            else if (accuracy >= 0.75) predictedPart5Score = 140;
            else if (accuracy >= 0.70) predictedPart5Score = 130;
            else if (accuracy >= 0.65) predictedPart5Score = 120;
            else if (accuracy >= 0.60) predictedPart5Score = 110;
            else if (accuracy >= 0.55) predictedPart5Score = 100;
            else if (accuracy >= 0.50) predictedPart5Score = 90;
            else if (accuracy >= 0.40) predictedPart5Score = 75;
            else predictedPart5Score = Math.round(accuracy * 180);
            
            const estimatedReadingScore = Math.round(predictedPart5Score * 2.75);
            const minTotalScore = Math.max(10, Math.round(estimatedReadingScore * 0.75));
            const maxTotalScore = Math.min(990, Math.round(estimatedReadingScore * 1.25));
            
            let level;
            if (estimatedReadingScore >= 450) level = 'A„É¨„Éô„É´Ôºà„Éè„Ç§„Çπ„Ç≥„Ç¢Ôºâ';
            else if (estimatedReadingScore >= 400) level = 'B„É¨„Éô„É´Ôºà‰∏äÁ¥öÔºâ';
            else if (estimatedReadingScore >= 350) level = 'C„É¨„Éô„É´Ôºà‰∏≠‰∏äÁ¥öÔºâ';
            else if (estimatedReadingScore >= 300) level = 'D„É¨„Éô„É´Ôºà‰∏≠Á¥öÔºâ';
            else if (estimatedReadingScore >= 250) level = 'E„É¨„Éô„É´ÔºàÂàù‰∏≠Á¥öÔºâ';
            else level = 'F„É¨„Éô„É´ÔºàÂü∫Á§éÔºâ';
            
            return {
                part5Score: predictedPart5Score,
                readingScore: estimatedReadingScore,
                minTotalScore,
                maxTotalScore,
                level
            };
        }
        
        function updateHomeScorePrediction() {
            const history = loadTestHistory();
            
            if (history.length === 0) {
                log('„ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå0‰ª∂„ÅÆ„Åü„ÇÅ„ÄÅ„Éõ„Éº„É†ÁîªÈù¢„Å´„Çπ„Ç≥„Ç¢‰∫àÊ∏¨„ÅØË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì', 'warning');
                return;
            }
            
            const latestTest = history[history.length - 1];
            const prediction = predictTOEICScore(latestTest.score, 30);
            const date = new Date(latestTest.timestamp);
            const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
            
            document.getElementById('homePart5Score').textContent = prediction.part5Score;
            document.getElementById('homeReadingScore').textContent = prediction.readingScore;
            document.getElementById('homeTotalScore').textContent = `${prediction.minTotalScore}-${prediction.maxTotalScore}`;
            document.getElementById('homeScoreLevel').textContent = prediction.level;
            document.getElementById('homeScoreDate').textContent = `ÂâçÂõû„ÉÜ„Çπ„Éà: ${dateStr}`;
            
            log('‚úÖ „Éõ„Éº„É†ÁîªÈù¢„ÅÆ„Çπ„Ç≥„Ç¢‰∫àÊ∏¨„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
            log(`   PART5: ${prediction.part5Score}ÁÇπ, „É™„Éº„Éá„Ç£„É≥„Ç∞: ${prediction.readingScore}ÁÇπ`, 'info');
        }
        
        function updateMyScoreDisplay(testResult) {
            const prediction = predictTOEICScore(testResult.score, 30);
            const percentage = Math.round((testResult.score / 30) * 100);
            const date = new Date(testResult.timestamp);
            const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
            
            document.getElementById('myScorePart5').textContent = prediction.part5Score;
            document.getElementById('myScoreReading').textContent = prediction.readingScore;
            document.getElementById('myScoreTotal').textContent = `${prediction.minTotalScore}-${prediction.maxTotalScore}`;
            document.getElementById('myScoreAccuracy').textContent = `${percentage}%`;
            document.getElementById('myScoreLevel').textContent = prediction.level;
            document.getElementById('myScoreDate').textContent = dateStr;
            
            log('‚úÖ „Éû„Ç§„Çπ„Ç≥„Ç¢ÁîªÈù¢„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
            log(`   Ê≠£Á≠îÁéá: ${percentage}%, „É¨„Éô„É´: ${prediction.level}`, 'info');
        }
        
        function renderScoreHistoryChart(history) {
            const canvas = document.getElementById('scoreHistoryChart');
            const ctx = canvas.getContext('2d');
            
            const recentHistory = history.slice(-10);
            
            const labels = recentHistory.map((test, index) => {
                const date = new Date(test.timestamp);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            });
            
            const part5Scores = recentHistory.map(test => {
                const prediction = predictTOEICScore(test.score, 30);
                return prediction.part5Score;
            });
            
            const readingScores = recentHistory.map(test => {
                const prediction = predictTOEICScore(test.score, 30);
                return prediction.readingScore;
            });
            
            if (window.scoreChart) {
                window.scoreChart.destroy();
            }
            
            window.scoreChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'PART5‰∫àÊ∏¨„Çπ„Ç≥„Ç¢',
                            data: part5Scores,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: '„É™„Éº„Éá„Ç£„É≥„Ç∞‰∫àÊ∏¨',
                            data: readingScores,
                            borderColor: '#f093fb',
                            backgroundColor: 'rgba(240, 147, 251, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'PART5„Çπ„Ç≥„Ç¢'
                            },
                            min: 0,
                            max: 200
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '„É™„Éº„Éá„Ç£„É≥„Ç∞'
                            },
                            min: 0,
                            max: 495,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
            
            log(`‚úÖ „Çπ„Ç≥„Ç¢Â±•Ê≠¥„Ç∞„É©„Éï„ÇíÊèèÁîª„Åó„Åæ„Åó„ÅüÔºà${recentHistory.length}‰ª∂Ôºâ`, 'success');
        }
        
        function generateTestData(count) {
            const history = [];
            const now = Date.now();
            
            for (let i = 0; i < count; i++) {
                // „É©„É≥„ÉÄ„É†„Å™„Çπ„Ç≥„Ç¢ÔºàÂæê„ÄÖ„Å´‰∏äÊòá„Åô„Çã„Éà„É¨„É≥„ÉâÔºâ
                const baseScore = 15 + Math.floor(i * 1.5);
                const score = Math.min(30, baseScore + Math.floor(Math.random() * 5));
                
                history.push({
                    testNumber: i + 1,
                    score: score,
                    timestamp: now - (count - i) * 24 * 60 * 60 * 1000, // 1Êó•„Åö„Å§Ââç
                    totalTime: Math.floor(Math.random() * 600) + 300
                });
            }
            
            return history;
        }
        
        function scenario1() {
            log('üß™ „Ç∑„Éä„É™„Ç™1: „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå0‰ª∂', 'info');
            clearData();
            
            updateHomeScorePrediction();
            
            log('üìä ÁµêÊûú: „Çπ„Ç≥„Ç¢‰∫àÊ∏¨„ÅØË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì', 'info');
            document.getElementById('scoreDisplay').style.display = 'none';
        }
        
        function scenario2() {
            log('üß™ „Ç∑„Éä„É™„Ç™2: „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå1‰ª∂', 'info');
            const history = generateTestData(1);
            saveTestHistory(history);
            log(`‚úÖ „ÉÜ„Çπ„Éà„Éá„Éº„Çø„Çí1‰ª∂ÁîüÊàê„Åó„Åæ„Åó„Åü`, 'success');
            
            updateHomeScorePrediction();
            const latestTest = history[history.length - 1];
            updateMyScoreDisplay(latestTest);
            renderScoreHistoryChart(history);
            
            document.getElementById('scoreDisplay').style.display = 'block';
        }
        
        function scenario3() {
            log('üß™ „Ç∑„Éä„É™„Ç™3: „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå5‰ª∂', 'info');
            const history = generateTestData(5);
            saveTestHistory(history);
            log(`‚úÖ „ÉÜ„Çπ„Éà„Éá„Éº„Çø„Çí5‰ª∂ÁîüÊàê„Åó„Åæ„Åó„Åü`, 'success');
            
            updateHomeScorePrediction();
            const latestTest = history[history.length - 1];
            updateMyScoreDisplay(latestTest);
            renderScoreHistoryChart(history);
            
            document.getElementById('scoreDisplay').style.display = 'block';
        }
        
        function scenario4() {
            log('üß™ „Ç∑„Éä„É™„Ç™4: „ÉÜ„Çπ„ÉàÂ±•Ê≠¥„Åå15‰ª∂Ôºà„Ç∞„É©„Éï„ÅØÊúÄÊñ∞10‰ª∂„ÅÆ„ÅøË°®Á§∫Ôºâ', 'info');
            const history = generateTestData(15);
            saveTestHistory(history);
            log(`‚úÖ „ÉÜ„Çπ„Éà„Éá„Éº„Çø„Çí15‰ª∂ÁîüÊàê„Åó„Åæ„Åó„Åü`, 'success');
            log(`   „Ç∞„É©„Éï„Å´„ÅØÊúÄÊñ∞10‰ª∂„ÅÆ„ÅøË°®Á§∫„Åï„Çå„Åæ„Åô`, 'info');
            
            updateHomeScorePrediction();
            const latestTest = history[history.length - 1];
            updateMyScoreDisplay(latestTest);
            renderScoreHistoryChart(history);
            
            document.getElementById('scoreDisplay').style.display = 'block';
        }
        
        log('„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü', 'success');
        log('‰∏äÈÉ®„ÅÆ„Éú„Çø„É≥„Åã„Çâ„ÉÜ„Çπ„Éà„Ç∑„Éä„É™„Ç™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'info');
    </script>
</body>
</html>
