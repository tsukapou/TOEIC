<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ‚äº†ãƒœã‚¿ãƒ³ä¿®æ­£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #f3f4f6;
        }
        .test-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
        }
        .error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ çµ‚äº†ãƒœã‚¿ãƒ³ä¿®æ­£ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-panel">
        <h2>âŒ ç™ºç”Ÿã—ã¦ã„ãŸã‚¨ãƒ©ãƒ¼</h2>
        <div class="error">
            <strong>TypeError: Secretary.onProgressUpdate is not a function</strong><br>
            at saveProgress (app.js:1086:15)
        </div>
        
        <h3 style="margin-top: 20px;">åŸå› </h3>
        <p>
            <code>Secretary.onProgressUpdate()</code> ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã«ã€
            ãƒã‚§ãƒƒã‚¯ãªã—ã§å‘¼ã³å‡ºã—ã¦ã„ã¾ã—ãŸã€‚
        </p>
        
        <h3>ä¿®æ­£å†…å®¹</h3>
        <p>
            <strong>ä¿®æ­£å‰:</strong>
        </p>
        <pre style="background: #fee2e2; padding: 10px; border-radius: 4px;">if (typeof Secretary !== 'undefined') {
  Secretary.onProgressUpdate(completedTests);
}</pre>
        
        <p style="margin-top: 15px;">
            <strong>ä¿®æ­£å¾Œ:</strong>
        </p>
        <pre style="background: #d1fae5; padding: 10px; border-radius: 4px;">if (typeof Secretary !== 'undefined' && typeof Secretary.onProgressUpdate === 'function') {
  Secretary.onProgressUpdate(completedTests);
}</pre>
    </div>
    
    <div class="test-panel">
        <h2>ğŸ§ª å‹•ä½œãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testSaveProgress()">saveProgress() ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testFinishTest()">finishTest() ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
        
        <div id="log" class="log" style="margin-top: 15px;">ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„...</div>
    </div>
    
    <div class="test-panel">
        <h2>âœ… ç¢ºèªæ–¹æ³•</h2>
        <ol style="line-height: 2;">
            <li>ã“ã®ãƒšãƒ¼ã‚¸ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„ã“ã¨ã‚’ç¢ºèª</li>
            <li><code>index.html</code> ã‚’é–‹ã</li>
            <li>ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦30å•ã™ã¹ã¦å›ç­”</li>
            <li>ã€Œãƒ†ã‚¹ãƒˆã‚’çµ‚äº†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>âœ… çµæœç”»é¢ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚Œã°OK</li>
        </ol>
    </div>

    <script>
        const STORAGE_KEYS = {
            progress: 'toeic_part5_progress',
            scores: 'toeic_part5_scores'
        };
        
        let logElement;
        
        function log(message, type = 'info') {
            if (!logElement) logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            logElement.textContent += `[${timestamp}] ${icon} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            if (!logElement) logElement = document.getElementById('log');
            logElement.textContent = 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ\n';
        }
        
        function getProgress() {
            const stored = localStorage.getItem(STORAGE_KEYS.progress);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    return { tests: {}, completedQuestions: [] };
                }
            }
            return { tests: {}, completedQuestions: [] };
        }
        
        function saveProgress() {
            log('ğŸ“ saveProgress() å®Ÿè¡Œé–‹å§‹...', 'info');
            
            // é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const progress = getProgress();
            
            // ãƒ€ãƒŸãƒ¼ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
            const testNumber = Object.keys(progress.tests).length + 1;
            progress.tests[testNumber] = {
                completed: true,
                score: 24,
                timestamp: Date.now()
            };
            
            log(`   ãƒ†ã‚¹ãƒˆ${testNumber}ã‚’é€²æ—ã«è¿½åŠ `, 'info');
            
            // LocalStorageã«ä¿å­˜
            localStorage.setItem(STORAGE_KEYS.progress, JSON.stringify(progress));
            log('   LocalStorageã«ä¿å­˜å®Œäº†', 'success');
            
            // ç§˜æ›¸ã«é€²æ—æ›´æ–°ã‚’é€šçŸ¥ï¼ˆä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ï¼‰
            const completedTests = Object.keys(progress.tests).length;
            log(`   å®Œäº†ãƒ†ã‚¹ãƒˆæ•°: ${completedTests}`, 'info');
            
            if (typeof Secretary !== 'undefined' && typeof Secretary.onProgressUpdate === 'function') {
                log('   Secretary.onProgressUpdate() ã‚’å‘¼ã³å‡ºã—', 'info');
                Secretary.onProgressUpdate(completedTests);
            } else {
                log('   Secretary.onProgressUpdate() ã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰', 'warning');
            }
            
            log('âœ… saveProgress() å®Œäº†ï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰', 'success');
        }
        
        function testSaveProgress() {
            log('\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('ğŸ§ª ãƒ†ã‚¹ãƒˆ: saveProgress()', 'info');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            
            try {
                saveProgress();
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('ğŸ‰ ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ã‚¨ãƒ©ãƒ¼ãªã—ï¼', 'success');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n', 'info');
            } catch (error) {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, 'error');
                log(`   ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n', 'info');
            }
        }
        
        function testFinishTest() {
            log('\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            log('ğŸ§ª ãƒ†ã‚¹ãƒˆ: finishTest() ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'info');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
            
            try {
                log('1. ã‚¿ã‚¤ãƒãƒ¼åœæ­¢ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰', 'info');
                log('2. çµæœã‚’è¨ˆç®—ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰', 'info');
                log('3. ãƒ†ã‚¹ãƒˆå±¥æ­´ã‚’ä¿å­˜ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰', 'info');
                
                // saveProgress() ã‚’å®Ÿè¡Œ
                saveProgress();
                
                log('4. çµæœç”»é¢ã‚’è¡¨ç¤ºï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰', 'info');
                
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('ğŸ‰ ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ã‚¨ãƒ©ãƒ¼ãªã—ï¼', 'success');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n', 'info');
            } catch (error) {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, 'error');
                log(`   ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}`, 'error');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n', 'info');
            }
        }
        
        // åˆæœŸåŒ–
        log('âœ… ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
        log('ä¸Šéƒ¨ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
    </script>
</body>
</html>
