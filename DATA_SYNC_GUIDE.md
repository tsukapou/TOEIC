# 📱 端末間学習履歴引継ぎガイド

## 🎯 概要

**データ同期システム**により、複数の端末（スマホ・タブレット・PC）間で学習履歴を引き継ぐことができます！

---

## ✨ 機能一覧

### 📤 データエクスポート
- 全ての学習データをJSONファイルとしてダウンロード
- テスト進捗、ポイント、ストリーク、復習問題など12種類のデータ

### 📥 データインポート
- エクスポートしたファイルを別の端末で読み込み
- **マージモード**: 既存データと統合（推奨）
- **上書きモード**: 既存データを完全に置き換え

### 🔄 データマージ
- **テスト進捗**: より良いスコアを保持
- **ストリーク**: 最長記録を保持、学習日を統合
- **デイリーポイント**: 累計ポイントを合算
- **復習問題**: 重複を排除して統合
- **解放済み秘書**: 両方の端末で解放済みの秘書を統合

### ⚠️ データクリア
- 全学習データの削除（2段階確認）

---

## 📋 エクスポート対象データ

### 学習進捗データ
1. **テスト進捗** (`toeic_tests_progress`)
   - 各テストの完了状況、スコア、正答率
   
2. **間違えた問題** (`toeic_wrong_answers`)
   - 復習が必要な問題リスト
   
3. **復習進捗** (`toeic_review_progress`)
   - 各問題の復習状況、マスター状態

### 継続学習データ
4. **学習ストリーク** (`toeic_streak_data`)
   - 現在の連続日数、最長記録、総学習日数
   
5. **デイリーミッション** (`toeic_daily_missions`)
   - 累計ポイント、ミッション達成履歴

### 分析データ
6. **弱点分析** (`toeic_weakness_data`)
   - カテゴリ別正答率、弱点カテゴリ
   
7. **解法パターン進捗** (`toeic_pattern_progress`)
   - パターン別マスター状況

### 秘書データ
8. **選択中の秘書** (`toeic_selected_secretary`)
   - 現在使用中の秘書
   
9. **解放済み秘書** (`toeic_unlocked_secretaries`)
   - ポイントで解放した秘書リスト

### その他
10. **ポイント報酬** (`toeic_point_rewards`)
    - 購入済みリワード、使用ポイント
    
11. **達成記録** (`toeic_reward_achievements`)
    - 称号、ご褒美イベント達成状況
    
12. **秘書デイリー会話** (`toeic_secretary_daily_last`)
    - 最後に表示した日次会話の日付

---

## 🚀 使い方

### ステップ1：端末Aでエクスポート

1. ホーム画面の **「🔄 データ引継ぎ」** ボタンをクリック

2. **「📤 データをエクスポート」** セクションで **「💾 ファイルをダウンロード」** をクリック

3. ファイルがダウンロードされます
   - ファイル名: `toeic_learning_data_YYYY-MM-DD.json`
   - 保存場所: ブラウザのダウンロードフォルダ

### ステップ2：ファイルを端末Bに転送

以下のいずれかの方法でファイルを転送：

- **クラウドストレージ**: Google Drive、iCloud、Dropboxなど
- **メール**: 自分宛にファイルを送信
- **メッセージアプリ**: LINE、WhatsAppなど
- **USBケーブル**: 直接接続して転送

### ステップ3：端末Bでインポート

1. 端末Bで TOEIC PART5 アプリを開く

2. **「🔄 データ引継ぎ」** ボタンをクリック

3. **インポートオプション** を設定：
   - ✅ **既存データとマージする（推奨）**: 両方のデータを統合
   - ☐ **既存データを上書きする**: 完全に置き換え

4. **「📥 データをインポート」** セクションで **「📂 ファイルを選択」** をクリック

5. エクスポートしたJSONファイルを選択

6. 確認ダイアログが表示されたら **「OK」** をクリック

7. ページが自動的にリロードされ、データが反映されます ✅

---

## 💡 推奨使用例

### ケース1：スマホ → PC
出勤中にスマホで学習 → 帰宅後にPCで続きから学習

1. スマホでエクスポート
2. クラウドストレージにアップロード
3. PCでダウンロード＆インポート
4. PCで続きから学習！

### ケース2：複数デバイスの統合
自宅PC、会社PC、スマホの3つのデバイスで学習していた場合

1. 各デバイスでエクスポート
2. 1つのデバイス（例：自宅PC）に全ファイルをインポート
3. マージモードで統合
4. 統合したデータを再度エクスポート
5. 他のデバイスにインポート

### ケース3：機種変更
古いスマホ → 新しいスマホ

1. 古いスマホでエクスポート
2. クラウドストレージまたはメールで送信
3. 新しいスマホで受信＆インポート
4. 学習データを完全に引継ぎ！

---

## ⚙️ データマージの詳細

### マージモード（推奨）

**テスト進捗:**
```
端末A: Test1=85%, Test2=90%
端末B: Test1=80%, Test3=88%
結果: Test1=85%(高い方), Test2=90%, Test3=88%
```

**学習ストリーク:**
```
端末A: 最長7日、総10日
端末B: 最長5日、総8日
結果: 最長7日、総10日（大きい方）
```

**デイリーポイント:**
```
端末A: 500pt
端末B: 300pt
結果: 800pt（合算）
```

**復習問題:**
```
端末A: 問題1, 問題2, 問題3
端末B: 問題2, 問題4
結果: 問題1, 問題2, 問題3, 問題4（統合・重複排除）
```

**解放済み秘書:**
```
端末A: さくら, レイナ, ユイ
端末B: さくら, レイナ, ミオ
結果: さくら, レイナ, ユイ, ミオ（統合）
```

---

## ⚠️ 注意事項

### エクスポート時
- ✅ 定期的にエクスポートしてバックアップを取りましょう
- ✅ ファイル名に日付が含まれるので、複数バージョンを保存可能
- ⚠️ ファイルサイズは学習データ量に依存（通常10KB〜100KB程度）

### インポート時
- ✅ **マージモード推奨**: データを失わずに統合できます
- ⚠️ **上書きモード**: 既存データが完全に消えるので注意
- ⚠️ バージョンが異なる場合は確認ダイアログが表示されます
- ✅ インポート後は自動的にページがリロードされます

### データ削除時
- ⚠️ **2段階確認**: 誤削除を防ぐため2回確認が必要
- ❌ **取り消し不可**: 削除したデータは復元できません
- ✅ 削除前に必ずエクスポートしてバックアップを取りましょう

---

## 🔧 トラブルシューティング

### Q1: エクスポートしたファイルが見つからない
**A:** ブラウザのダウンロードフォルダを確認してください
- Chrome: `chrome://downloads/`
- Safari: `~/Downloads/`
- Firefox: `about:downloads`

### Q2: インポート時にエラーが出る
**A:** 以下を確認してください：
1. ファイルが正しいJSON形式か
2. ファイルが破損していないか
3. 別のアプリのデータファイルでないか

### Q3: インポート後にデータが反映されない
**A:** ページを手動でリロードしてください（F5またはCmd+R）

### Q4: マージしたらポイントが多すぎる
**A:** 複数デバイスの累計ポイントが合算されるため正常です
   - ポイントを減らしたい場合は上書きモードでインポート

### Q5: データを間違って削除してしまった
**A:** バックアップがあれば復元可能：
1. 最新のエクスポートファイルを探す
2. インポート機能で復元

---

## 📊 データ形式（開発者向け）

### エクスポートファイルの構造

```json
{
  "version": "1.0.0",
  "exportDate": "2025-12-08T12:34:56.789Z",
  "exportTimestamp": 1733662496789,
  "data": {
    "toeic_tests_progress": { ... },
    "toeic_selected_secretary": "sakura",
    "toeic_unlocked_secretaries": ["sakura", "reina", "yui"],
    "toeic_wrong_answers": [ ... ],
    "toeic_streak_data": { ... },
    "toeic_daily_missions": { ... },
    ...
  }
}
```

### バージョン管理
- **現在**: v1.0.0
- 将来のバージョンでもインポート互換性を維持予定

---

## 🎯 ベストプラクティス

### 定期バックアップ
- **推奨頻度**: 週に1回
- **タイミング**: 大きな進捗があった後（テスト完了時など）

### 複数デバイス使用時
1. **メインデバイス**を決める
2. 他のデバイスで学習後、メインデバイスにマージ
3. メインデバイスから最新データを他デバイスに配布

### クラウド保存
- Google Drive、Dropboxなどに定期的にアップロード
- フォルダ構造: `TOEIC学習データ/YYYY-MM/ファイル名.json`

---

## 📈 期待効果

- ✅ **継続率UP**: どの端末でも学習を継続できる
- ✅ **データ保全**: バックアップによる安心感
- ✅ **柔軟性**: 状況に応じて最適な端末で学習
- ✅ **モチベーション維持**: 学習データが途切れない

---

**実装日**: 2025-12-08  
**バージョン**: 1.0.0  
**ステータス**: ✅ 完全実装済み
