<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ©ãƒ³ã‚­ãƒ³ã‚° | TOEIC PART5 å­¦ç¿’ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="css/social-features.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="ranking-container">
        <div class="ranking-header">
            <h1>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
            <p>å…¨å›½ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç«¶äº‰ã—ã‚ˆã†ï¼</p>
        </div>
        
        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="ranking-tabs">
            <button class="ranking-tab active" onclick="switchTab('all')">å…¨å›½ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
            <button class="ranking-tab" onclick="switchTab('friends')">ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
        </div>
        
        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆ -->
        <div class="ranking-list" id="rankingList">
            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>
        
        <!-- ãƒ•ãƒ¬ãƒ³ãƒ‰æ‹›å¾…ã‚«ãƒ¼ãƒ‰ -->
        <div class="friend-invite-card">
            <h2>ğŸ‘¥ å‹é”ã‚’æ‹›å¾…ã—ã‚ˆã†ï¼</h2>
            <p>å‹é”ã¨ä¸€ç·’ã«å­¦ç¿’ã™ã‚‹ã¨ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒ3å€ã‚¢ãƒƒãƒ—ï¼</p>
            <button class="btn-invite-friend" onclick="inviteFriend()">
                ğŸ“¤ æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ã‚·ã‚§ã‚¢
            </button>
        </div>
        
        <!-- ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div style="text-align: center; margin-top: 30px;">
            <a href="index.html" style="color: white; text-decoration: none; font-size: 18px; font-weight: 600;">
                â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </a>
        </div>
    </div>
    
    <script src="js/social-features.js"></script>
    <script>
        let currentTab = 'all';
        
        function switchTab(tab) {
            currentTab = tab;
            
            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.ranking-tab').forEach(t => {
                t.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°
            renderRanking();
        }
        
        function renderRanking() {
            if (!window.socialFeatures) {
                setTimeout(renderRanking, 100);
                return;
            }
            
            const rankingData = window.socialFeatures.getRankingData();
            const rankingList = document.getElementById('rankingList');
            
            if (currentTab === 'friends') {
                // ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ‡ãƒ¢ç‰ˆã§ã¯è‡ªåˆ†ã®ã¿ï¼‰
                const myData = rankingData.find(u => u.isMe);
                rankingList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: white;">
                        <p style="font-size: 18px; margin-bottom: 20px;">ã¾ã ãƒ•ãƒ¬ãƒ³ãƒ‰ãŒã„ã¾ã›ã‚“</p>
                        <p style="font-size: 14px; opacity: 0.8;">å‹é”ã‚’æ‹›å¾…ã—ã¦ä¸€ç·’ã«å­¦ç¿’ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
                    </div>
                `;
                return;
            }
            
            // å…¨å›½ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            rankingList.innerHTML = rankingData.map(user => {
                const isTopThree = user.rank <= 3;
                const medalEmoji = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][user.rank - 1] || '';
                
                return `
                    <div class="ranking-item ${user.isMe ? 'me' : ''}">
                        <div class="ranking-rank ${isTopThree ? 'ranking-rank-medal' : ''}">
                            ${isTopThree ? medalEmoji : user.rank}
                        </div>
                        <div class="ranking-avatar">
                            ${user.isMe ? 'ğŸ˜Š' : 'ğŸ‘¤'}
                        </div>
                        <div class="ranking-info">
                            <div class="ranking-username">${user.username}</div>
                            <div class="ranking-stats">ãƒ†ã‚¹ãƒˆ${user.totalTests}å›å®Ÿæ–½</div>
                        </div>
                        <div class="ranking-score">
                            ${user.highScore}<span style="font-size: 16px; opacity: 0.8;">/30</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function inviteFriend() {
            const inviteText = `TOEIC PART5ã®å­¦ç¿’ã‚¢ãƒ—ãƒªã§ä¸€ç·’ã«å‹‰å¼·ã—ã¾ã›ã‚“ã‹ï¼Ÿ\\n\\næ¯æ—¥30å•ã§ç¢ºå®Ÿã«ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ï¼\\nç„¡æ–™ã§å§‹ã‚ã‚‰ã‚Œã¾ã™ ğŸ“`;
            
            if (navigator.share) {
                // Web Share APIå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
                navigator.share({
                    title: 'TOEIC PART5 å­¦ç¿’ã‚¢ãƒ—ãƒª',
                    text: inviteText,
                    url: window.location.origin
                }).catch(err => console.log('ã‚·ã‚§ã‚¢ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'));
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šTwitterã¾ãŸã¯LINE
                const choice = confirm('Twitterã§ã‚·ã‚§ã‚¢ã—ã¾ã™ã‹ï¼Ÿ\\nï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§LINEã‚·ã‚§ã‚¢ï¼‰');
                
                if (choice) {
                    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(inviteText)}&hashtags=TOEIC,è‹±èªå­¦ç¿’`;
                    window.open(url, '_blank', 'width=550,height=420');
                } else {
                    const url = `https://line.me/R/msg/text/?${encodeURIComponent(inviteText)}`;
                    window.open(url, '_blank');
                }
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(renderRanking, 500);
        });
    </script>
</body>
</html>
